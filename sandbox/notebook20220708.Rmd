---
title: "notebook20220708"
output: html_document
date: '2022-07-08'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


I'll start with the fake dataset and the function already written

```{r}
load(here::here("data", "fake_student_df.rda"))

glimpse(fake_student_df)
```

Now apply the function

```{r}
check_missing_field(fake_student_df, birth_date, spbpers_activity_date, s_14)
check_missing_field(fake_student_df, birth_date, sgbstdn_activity_date, s_14) %>% 
  glimpse()
```

Based on this, I think:

- Need more activity_dates in the fake data
- For each validation row:
    - Create a status column, e.g. s_14_status
    - Create an activity date column, e.g. s_14_activity_date
    - Create an age column, e.g. s_14_age, corresponding to days since the activity date
- Is it really the case that we want to add 3 columns for each validation row? That would mean adding 732 columns to the dataframe. 
    - Could cut out 1/3 of the new columns since age is redundant with activity date
    - Looks like there's only a small number of activity_date variables that these come from. So these new columns will be redundant


For today's meeting I'd like to ask:

- What is intended use-case for this package? 
    - Who's using it?
    - How will the functions get called? e.g. automated report generation? Hands-on analysis? Interactive or scripts? Dashboards?
    - How well-specified is desired output? Is someone expecting S_04_status and S_04_activity_date? 
- Is the sample sql supposed to be different across the different rules? Looks mostly the same to me

Idea for developing:

- Each rule will generate a validation status and (probably) date and age
    - date and age are strightforward to automate with some auxilary data mapping code to status-date variable
    - Validation status will require most of the work
- Could auto-generate a skeleton

```{r}
input_df <- fake_student_df

# No banner_id
check_S00a <- function(input_df) {
  input_df
}

input_df$ssn
input_df$us_citizenship_code
input_df$student
```

- Looks like the fake data might not be complete? Tried looking for banner_id. But found student_id. How should I determine which variables are being referenced? I suppose that's the edify column. 
- Should I expect everything in the Edify column to be in the input dataframe?

